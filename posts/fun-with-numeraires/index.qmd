---
title: "Fun with numeraires!"
author: "Quasar"
date: "2024-11-28"
categories: [Stochastic Calculus]      
image: "image.jpg"
toc: true
toc-depth: 3
comments:
  giscus: 
    repo: quasar-chunawala/quantdev
---

## Introduction

A proficiency in the change-of-measure technique is useful to the working quant. An excellent summary of the important results is the note [Girsanov, Numeraires and all that](https://www.researchgate.net/publication/361692645_Girsanov_Numeraires_and_All_That), by Andrew Lesniewski. In this post, I would like to derive relevant results and then we can enjoy pricing some payoffs together!

## Girsanov Theorem

:::{#thm-Girsanov-theorem}

### Girsanov Theorem

Let $(W^{\mathbb{P}},t\geq 0)$ be a $\mathbb{P}$ standard brownian motion on $(\Omega,\mathcal{F},\mathbb{P})$ and let $\phi$ be any adapted process. Choose fixed $T$ and defined the process $L$ on $[0,T]$ by:

$$
\begin{align*}
dL_t = \phi_t L_t dW^{\mathbb{P}}_t
\end{align*}
$$ {#eq-dynamics-of-Lt}

$$
\begin{align*}
L_0 = 1
\end{align*}
$$ {#eq-initial-condition}

that is:

$$
\begin{align*}
L_t = \exp\left(\int_0^t \phi_s dW^{\mathbb{P}}_s - \int_0^t \phi^2_s ds\right)
\end{align*}
$$ {#eq-likelihood-process}

Assume that:

$$
\begin{align*}
\mathbb{E}^{\mathbb{P}}[L_T] = 1
\end{align*}
$$ {#eq-expectation-of-likelihood-process}

and define the new probability measure $\mathbb{Q}$ on $\mathcal{F}_t$ by:

$$
L_T = \frac{d\mathbb{Q}}{d\mathbb{P}}
$$ {#eq-radon-nikodym-derivative}

Then,

$$
dW^{\mathbb{P}}_t = dW^{\mathbb{Q}}_t + \phi_t dt
$$ {#eq-girsanov-transformation}

where $dW^{\mathbb{Q}}_t$ is a $\mathbb{Q}$-standard brownian motion.

:::

*Proof.*

Our claim is that, under the $\mathbb{Q}$ measure, the increments $(W^{\mathbb{Q}}_t - W^{\mathbb{Q}}_s)$ are normally distributed with mean $0$ and variance $(t-s)$. We start with the special case $s=0$. Using moment generating functions, it is enough to show that:

It is straightforward to derive @eq-likelihood-process using Ito's lemma. Let $f(x) = \ln x$. Then, $f_x = -\frac{1}{x}$, $f_{xx} = -\frac{1}{x^2}$.

$$
\begin{align*}
d(\ln L_t) &= -\frac{1}{L_t}dL_t + \frac{1}{L_t^2}(dL_t)^2 \\
&= -\frac{1}{L_t}{\phi_t L_t dW^{\mathbb{P}}_t} + \frac{1}{L_t^2}\phi_t^2 L_t^2 dt\\
&= - \phi_t dW^{\mathbb{P}}_t + \phi_t^2 dt \\
L_t &= \exp\left(-\int_0^t \phi_s dW^{\mathbb{P}}_s + \frac{1}{2}\int_0^t \phi_s^2 ds \right)
\end{align*}
$$

To prove our main result, we will now use the MGF of the increments. For $n \in \mathbb{N}$ and $(t_j,j\leq n)$ a partition of $[0,T]$, with $t_n = T$, I will show that :

$$
\begin{align*}
\mathbb{E}^{\mathbb{Q}}\left([\exp\left(\sum_{j=0}^{n-1}\lambda_j (W^{\mathbb{Q}}_{t_{j+1}} - W^{\mathbb{Q}}_{t_{j}})\right)\right] = \exp\left(\lambda_j^2(t_{j+1}-t_j)\right)
\end{align*}
$$ {#eq-MGF-of-gaussian}

This proves that the increments are the ones of standard brownian motion. 

Let $(\mathcal{F}_{t_j},j\leq n)$ be the filtrations of the Brownian motion at the time of the partition. The proof is by successively conditioning from $t_{n-1}$ to $t_1$. We have:

$$
\begin{align*}
\mathbb{E}^{\mathbb{Q}}\left[\exp\left(\sum_{j=0}^{n-1}\lambda_j (W^{\mathbb{Q}}_{t_{j+1}} - W^{\mathbb{Q}}_{t_{j}})\right)\right] &= 
\mathbb{E}^{\mathbb{P}}\left[\mathbb{E}^{\mathbb{P}}\left[M_{t_n}\exp\left(\sum_{j=0}^{n-1}\lambda_j (W^{\mathbb{Q}}_{t_{j+1}} - W^{\mathbb{Q}}_{t_{j}})\right)\vert\mathcal{F}_{t_{n-1}}\right]\right] \\
&=\mathbb{E}^{\mathbb{P}}\left[\sum_{j=0}^{n-2}\lambda_j (W^{\mathbb{Q}}_{t_{j+1}} - W^{\mathbb{Q}}_{t_{j}})\mathbb{E}^{\mathbb{P}}\left[M_{t_n}\exp\left(\lambda_{n-1}(W^{\mathbb{Q}}_{t_n} - W^{\mathbb{Q}}_{t_{n-1}})\right)\vert\mathcal{F}_{t_{n-1}}\right]\right] \\
&=\mathbb{E}^{\mathbb{P}}\left[\sum_{j=0}^{n-2}\lambda_j (W^{\mathbb{Q}}_{t_{j+1}} - W^{\mathbb{Q}}_{t_{j}})\mathbb{E}^{\mathbb{P}}\left[\exp\left(-\int_{t_{n-1}}^{t_n}-\theta dW^{\mathbb{Q}}_s + \frac{1}{2}\int_{t_{n-1}}^{t_n}\theta_s^2 ds\right)\exp\left(\lambda_{n-1}\int_{t_{n-1}}^{t_n}dW^{\mathbb{Q}}_s\right)\vert\mathcal{F}_{t_{n-1}}\right]\right] \\ 
\end{align*}
$$

## Pricing the payoff $V(T) = S_T(S_T - K)^{+}$

Under the risk-neutral measure $\mathbb{Q}^M$ associated with the money-market account numeraire $M(t)$, the stock price $S(t)$ evolves according to:

$$
\begin{align*}
dS_t = r S_t dt + \sigma S_t dW^{\mathbb{Q}^M}
\end{align*}
$$ {#eq-diffusion}

which has the solution:

$$
\begin{align*}
S_t = S_0\exp\left[\left(r - \frac{\sigma^2}{2}\right)t + \sigma W^{\mathbb{Q}^M}(t)\right]
\end{align*}
$$ {#eq-solution-of-gbm}

By the risk-neutral pricing formula, we have:

$$
\begin{align*}
V(0) &= \mathbb{E}^{\mathbb{Q}^M}\left[\frac{V(T)}{M(T)}\right] \\
&= \mathbb{E}^{\mathbb{Q}^M}\left[\frac{S_T}{M_T}(S_T - K)^{+}\right]
\end{align*}
$$ {#eq-risk-neutral}

By the change-of-measure formula, if $N$ is any other numeraire with associated probability measure $\mathbb{Q}^N$, we know that:

$$
\begin{align*}
\mathbb{E}^{\mathbb{Q}^N}[V(T)]=\mathbb{E}^{\mathbb{Q}^M}\left[\frac{d\mathbb{Q}^N}{d\mathbb{Q}^M}V(T)\right]
\end{align*}
$$ {#eq-change-of-measure}

We switch to the stock numeraire $S_t$. The Radon-Nikodym derivative $L_T = d\mathbb{Q}^S/d\mathbb{Q}^M$ is simply:

$$
\begin{align*}
L_T = \frac{d\mathbb{Q}^S}{d\mathbb{Q}^M} = \frac{S(T)/S(0)}{M(T)/M(0)}  = \frac{1}{S(0)}\cdot \frac{S(T)}{M(T)}
\end{align*}
$$ {#eq-radon-nikodym}

The dynamics of $L_t$ under the $\mathbb{Q}_M$ measure is given by:

$$
dL_t = \phi_t L_t dW^{\mathbb{Q}^M}
$$

where the Girsanov kernel $\phi_t = \sigma$. Then, the Girsanov transformation is:

$$
W^{\mathbb{Q}^M}_T = W^{\mathbb{Q}^S}_T + \sigma T
$$ {#eq-girsanov-drift}

So, the $\mathbb{Q}^S$ dynamics of the stock price is:

$$
\begin{align*}
S_T &= S_0 \exp\left[\left(r - \frac{\sigma^2}{2}\right)T + \sigma (W^{\mathbb{Q}^S}_T + \sigma T)\right]\\
&=  S_0 \exp\left[\left(r + \frac{\sigma^2}{2}\right)T + \sigma (W^{\mathbb{Q}^S}_T)\right]
\end{align*}
$$ {#eq-Qs-dynamics}

We can develop the expression in @eq-risk-neutral to be:

$$
\begin{align*}
V(0) &= S_0\mathbb{E}^{\mathbb{Q}^M}\left[\frac{1}{S_0}\frac{S_T}{M_T}(S_T - K)^{+}\right]
\end{align*}
$$ {#eq-develop-the-expression}

Applying the change-of-measure (abstract *Baye's* formula),we have:

$$
\begin{align*}
V(0) &= S_0\mathbb{E}^{\mathbb{Q}^S}\left[(S_T - K)^{+}\right]
\end{align*}
$$ {#eq-applying-change-of-measure-formula}

Now, we have:

$$
\begin{align*}
\mathbb{Q}^S(S_T > K) &= \mathbb{Q}^S\left(S_0 \exp\left[\left(r + \frac{\sigma^2}{2}\right)T + \sigma (W^{\mathbb{Q}^S}_T)\right] > K\right)\\
&= \mathbb{Q}^S\left(S_0 \exp\left[\left(r + \frac{\sigma^2}{2}\right)T + \sigma (-\sqrt{T}Z)\right] > K\right)\\
&= \mathbb{Q}^S\left(\log \frac{S_0}{K}  + \left(r + \frac{\sigma^2}{2}\right)T   > \sigma\sqrt{T}Z\right)\\
\end{align*}
$$ {#eq-probability-under-stock-measure}

where we subbed $-\sqrt{T}Z=W^{\mathbb{Q}^S}_T$. Recall, the standard normals $Z$ and $-Z$ have the same distribution by symmetry.

Define 

$$
d_{-} = \frac{\log \frac{S_0}{K}  + \left(r + \frac{\sigma^2}{2}\right)T}{\sigma\sqrt{T}}
$$ {#eq-expression-for-d2}

Then, since $Z \sim \mathcal{N}^{\mathbb{Q}^S}(0,1)$:

$$
\mathbb{Q}^S(S_T > K) = \mathbb{Q}^S(Z < d_{-}) = \Phi(d_{-})
$$ {#eq-STgtKprobability}

So, we can expand the expectation in @eq-applying-change-of-measure-formula. The indicator random variable $1_{\{S_T > K\}}$ is $1$ for all points $Z < d_{-}$. So, the limits of integration will be $-\infty$ to $d_{-}$.

$$
\begin{align*}
V(0) &= S_0\left[\int_{-\infty}^{d_{-}} S_T  d\mathbb{Q}^S - K\int_{-\infty}^{d_{-}} dQ^S\right]\\
&= S_0\left[\int_{-\infty}^{d_{-}} S_T f_Z^{\mathbb{Q}^S}(z)dz - K\int_{-\infty}^{d_{-}} f_Z^{\mathbb{Q}^S}(z)dz\right]\\
&= S_0\left[\frac{1}{\sqrt{2\pi}}\int_{-\infty}^{d_{-}} S_0 \exp\left[\left(r + \frac{\sigma^2}{2}\right)T - \sigma \sqrt{T}z\right] \exp(-\frac{z^2}{2})dz - K\Phi(d_{-})\right]
\end{align*}
$$

Completing the square, we have:

$$
\begin{align*}
V(0) &= S_0\left[\frac{1}{\sqrt{2\pi}}\int_{-\infty}^{d_{-}} S_0 \exp\left[-\frac{1}{2}(z^2 + 2\sigma\sqrt{T}z + (\sigma \sqrt{T})^2)\right] \exp\left[\left(r + \sigma^2\right)T\right]dz - K\Phi(d_{-})\right]\\
&=S_0 \left[S_0\frac{e^{(r + \sigma^2) T}}{\sqrt{2\pi}}\int_{-\infty}^{d_{-}} \exp\left(-\frac{1}{2}(z + \sigma\sqrt{T})^2\right) dz - K\Phi(d_{-})\right]\\
\end{align*}
$$

Let $u = z + \sigma\sqrt{T}$. And define:

$$
d_{+} = d_{-} + \sigma \sqrt{T} = \frac{\log \frac{S_0}{K} + \left(r + \frac{3}{2}\sigma^2\right)}{\sigma \sqrt{T}}
$$

We have the closed-form formula:

$$
V(0) = S_0^2 e^{(r+\sigma^2)T} \Phi(d_{+}) - KS_0 \Phi(d_{-})
$$


